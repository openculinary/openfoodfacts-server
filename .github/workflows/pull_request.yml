name: Pull Request checks

on:
  pull_request:
    # we can't do that, because status are required
    # see https://stackoverflow.com/questions/66751567/return-passing-status-on-github-workflow-when-using-paths-ignore
    # paths-ignore:
    #   - "**.md"
    #   - ".github/CODEOWNERS"
    #   - ".github/PULL_REQUEST_TEMPLATE.md"
    #   - ".editorconfig"
  push:
    branches:
    - main

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # FIXME:Â not used yet
  filter:
    name: "Filter changed paths"
    runs-on: ubuntu-latest
    outputs:
      code_changed: ${{ steps.filter.outputs.code }}
      docs_changed: ${{ steps.filter.outputs.docs }}
      only_docs_changed: ${{ steps.filter.outputs.docs == 'true' && steps.filter.outputs.code != 'true' }}

    steps:
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          # FIXME: we need to consider more than these files
          # We need to consider every file in the repository and have it in a category
          # Maybe using negative match: https://github.com/micromatch/picomatch?tab=readme-ov-file#advanced-globbing
          filters: |
            docs:
              - '**/*.md'
              - 'docs/**'
            code:
              - '**/*.pl'
              - '**/*.pm'
              - '**/*.js'
              - '**/*.scss'
              - '**/*.html'
              - 'conf/**'
              - 'lib/**'
              - 'scripts/**'
              - 'tests/**'
            taxonomies:
              - 'taxonomies/**/*'

  docs:
    name: "Warning: documentation modified"
    runs-on: ubuntu-latest
    needs: filter
    if: github.event_name == 'pull_request' && needs.filter.outputs.docs_changed == 'true'
    steps:
      - run: exit 1

  docs:
    name: "Warning: code modified"
    runs-on: ubuntu-latest
    needs: filter
    if: github.event_name == 'pull_request' && needs.filter.outputs.code_changed == 'true'
    steps:
      - run: exit 1
